name: Deploy Reference Documentation

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'SDK Version'
        required: true
        type: string

permissions:
  id-token: write

jobs:
  deploy-reference-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Configure Git
        run: |
          git config --global user.email "oss@expediagroup.com"
          git config --global user.name "eg-oss-ci"

      - name: Checkout gh-pages branch
        run: |
          git fetch origin mdwairi/refactor-docs-versioning
          git checkout mdwairi/refactor-docs-versioning

      - name: List directories in gh-pages (debug step)
        run: |
          echo "Directories in gh-pages branch:"
          ls -d */

      - name: Move latest release to the older directory
        run: |
          VERSION=$(jq -r '.version' version.json)
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          rsync -av --exclude='older' --exclude='.git' --exclude='README.md' --remove-source-files ./ older/$VERSION/
          find . -type d -empty -delete

      - name: Move the older directory to temporary workspace
        run: mv older/* $GITHUB_WORKSPACE/older/

      - name: Checkout to main
        run: git checkout main

      - name: list workspace content
        run: ls $GITHUB_WORKSPACE





